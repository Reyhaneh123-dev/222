<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Ø¹Ù…Ù„ÛŒØ§Øª Ø±ÙˆÛŒ Ù…Ø¬Ù…ÙˆØ¹Ù‡â€ŒÙ‡Ø§ â€” Ù†Ù…Ø§ÛŒØ´Ú¯Ø§Ù‡</title>

<style>
  :root{
    --violet:#7b1fa2;
    --blue:#1565c0;
    --muted:#6b7280;
  }

  body{
    margin:0;
    font-family:Tahoma, sans-serif;
    background:#faf7ff;
    color:#111;
  }

  header{
    background:linear-gradient(90deg,#f5eaff,var(--violet));
    color:#fff;
    padding:14px 20px;
    display:flex;
    justify-content:space-between;
    align-items:center;
  }

  .profile{
    display:flex;
    gap:10px;
    align-items:center;
  }

  .avatar{
    width:48px;height:48px;
    border-radius:50%;
    background:#fff3;
    display:flex;
    justify-content:center;
    align-items:center;
    font-weight:700;
    font-size:20px;
    color:white;
  }

  main{
    max-width:1000px;
    margin:20px auto;
    padding:0 14px;
  }

  .card{
    background:white;
    border-radius:12px;
    padding:16px;
    margin-bottom:14px;
    box-shadow:0 8px 20px rgba(0,0,0,0.06);
  }

  label{display:block; font-weight:700; margin:10px 0 6px;}
  select,input,button{
    padding:10px;
    border-radius:8px;
    border:1px solid #ddd;
    font-size:15px;
    width:100%;
  }

  button{
    background:var(--violet);
    color:white;
    border:none;
    cursor:pointer;
  }

  pre{
    background:#f6f3ff;
    padding:10px;
    border-radius:8px;
    white-space:pre-wrap;
    font-size:14px;
    border:1px solid #e8e0ff;
  }

  /* ğŸ”µ Ù†ÙˆØ§Ø± Ø¹Ù…Ù„ÛŒØ§Øª */
  .op-strip{
    display:flex;
    gap:8px;
    padding:10px 4px;
  }

  .op{
    padding:8px 14px;
    background:#fff8;
    border-radius:8px;
    border:1px solid #dacbff;
    font-size:18px;
    transition:0.25s;
  }

  .op.active{
    background:#fff4d6;
    transform:translateY(-5px);
    box-shadow:0 6px 20px rgba(0,0,0,0.1);
  }
</style>
</head>

<body>

<header>
  <div style="font-weight:800;font-size:20px;">
    Ø¹Ù…Ù„ÛŒØ§Øª Ø±ÙˆÛŒ Ù…Ø¬Ù…ÙˆØ¹Ù‡â€ŒÙ‡Ø§
  </div>

  <div class="profile">
    <div id="userNameDisplay" style="font-size:13px;"></div>
    <div id="avatar" class="avatar"></div>
  </div>
</header>

<main>

  <!-- ğŸ”µ Ù†Ù…Ø§ÛŒØ´ A -->
  <div class="card" id="showA"></div>

  <!-- ğŸ”µ Ø³Ø§Ø®Øª B -->
  <div class="card">
    <label>Ø³Ø§Ø®Øª Ù…Ø¬Ù…ÙˆØ¹Ù‡Ù” B (Ø±ÙˆØ´)</label>
    <select id="methodB">
      <option value="">Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯...</option>
      <option value="members">Ù†ÙˆØ´ØªÙ† Ø§Ø¹Ø¶Ø§ (Ù…Ø«Ù„Ø§Ù‹: 1,2,3)</option>
      <option value="symbol">Ù†ÙˆØ´ØªÙ† Ù†Ù…Ø§Ø¯ (Ù…Ø«Ù„Ø§Ù‹: { x âˆˆ N | x â‰¤ 5 })</option>
      <option value="known">Ø§Ø² Ù…Ø¬Ù…ÙˆØ¹Ù‡â€ŒÙ‡Ø§ÛŒ Ø´Ù†Ø§Ø®ØªÙ‡â€ŒØ´Ø¯Ù‡</option>
    </select>

    <div id="Bcontent" style="margin-top:10px"></div>
  </div>

  <!-- ğŸ”µ Ø¹Ù…Ù„ÛŒØ§Øª -->
  <div class="card">

    <label>Ø§Ù†ØªØ®Ø§Ø¨ Ø¹Ù…Ù„</label>
    <select id="operation">
      <option value="">Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯...</option>
      <option value="union">Ø§Ø¬ØªÙ…Ø§Ø¹ (A âˆª B)</option>
      <option value="intersection">Ø§Ø´ØªØ±Ø§Ú© (A âˆ© B)</option>
      <option value="difference">ØªÙØ§Ø¶Ù„ (A âˆ’ B)</option>
      <option value="subset">Ø¢ÛŒØ§ A âŠ‚ B Ø§Ø³ØªØŸ</option>
    </select>

    <!-- ğŸ”µ Ù†ÙˆØ§Ø± Ø¹Ù…Ù„ÛŒØ§Øª Ù…ØªØ­Ø±Ú© -->
    <div class="op-strip" id="op-strip">
      <div class="op">Ã·</div>
      <div class="op">+</div>
      <div class="op">Ã—</div>
      <div class="op">âˆ’</div>
    </div>

    <button id="btnCompute" style="margin-top:10px">Ù†Ù…Ø§ÛŒØ´ Ùˆ Ù…Ø­Ø§Ø³Ø¨Ù‡</button>
    <button id="btnSave" style="background:#3b82f6;margin-top:10px">Ø°Ø®ÛŒØ±Ù‡ Ù†ØªÛŒØ¬Ù‡</button>

    <div id="resultBox" style="margin-top:12px;font-size:15px;"></div>
  </div>

  <!-- ğŸ”µ ØªØ§Ø±ÛŒØ®Ú†Ù‡ -->
  <div class="card">
    <label>ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ø°Ø®ÛŒØ±Ù‡â€ŒØ´Ø¯Ù‡</label>
    <div id="history"></div>
  </div>

</main>

<script>
// ======================= Ù¾Ø±ÙˆÙØ§ÛŒÙ„ =======================
const user = localStorage.getItem("userName") || "Ú©Ø§Ø±Ø¨Ø±";
document.getElementById("userNameDisplay").innerText = user;

let initials = user.split(" ")[0][0];
if(user.split(" ")[1]) initials += user.split(" ")[1][0];
document.getElementById("avatar").innerText = initials;


// ======================= Ù…Ø¬Ù…ÙˆØ¹Ù‡ A =======================
const showA = document.getElementById("showA");
let setA = {type:"unknown", members:[], expr:null};

const savedExpr = localStorage.getItem("setA_expr");
const savedRaw = localStorage.getItem("setA_cond_raw");
const savedSet = localStorage.getItem("setA_set");

if(savedExpr){
  showA.innerHTML =
    `<b>Ù…Ø¬Ù…ÙˆØ¹Ù‡ A (Ø°Ø®ÛŒØ±Ù‡â€ŒØ´Ø¯Ù‡):</b><br>
     <div style="margin-top:6px;padding:10px;background:#f7faff;border-radius:8px;border:1px solid #e3eaff;">${savedExpr}</div>`;

  const nums = (savedRaw||"").match(/-?\d+/g);
  if(nums) setA = {type:"finite", members:[...new Set(nums.map(Number))]};
  else setA = {type:"symbolic", expr:savedExpr, raw:savedRaw, symbol:savedSet};
}
else{
  showA.innerHTML =
    `<b style="color:#c00">Ù…Ø¬Ù…ÙˆØ¹Ù‡ A ØªØ¹Ø±ÛŒÙ Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</b><br>
     Ø§Ø¨ØªØ¯Ø§ Ø¯Ø± ØµÙØ­Ù‡ Ù‚Ø¨Ù„ Ø¢Ù† Ø±Ø§ Ø¨Ø³Ø§Ø²ÛŒØ¯.`;
}


// ======================= Ø³Ø§Ø®Øª B =======================
const methodB = document.getElementById("methodB");
methodB.addEventListener("change", () => {
  if(methodB.value==="members"){
    Bcontent.innerHTML =
      `<label>Ø§Ø¹Ø¶Ø§ÛŒ B:</label>
       <input id="membersB" placeholder="Ù…Ø«Ù„Ø§Ù‹: 1,2,3">`;
  }
  else if(methodB.value==="symbol"){
    Bcontent.innerHTML =
      `<label>Ù†Ù…Ø§Ø¯ B:</label>
       <input id="symbolB" placeholder="{ x âˆˆ N | x â‰¤ 5 }">`;
  }
  else if(methodB.value==="known"){
    Bcontent.innerHTML =
      `<label>Ø§Ù†ØªØ®Ø§Ø¨ Ù…Ø¬Ù…ÙˆØ¹Ù‡:</label>
       <select id="knownB">
          <option value="N">N</option>
          <option value="W">W</option>
          <option value="Z">Z</option>
          <option value="Q">Q</option>
          <option value="I">I</option>
          <option value="R">R</option>
       </select>`;
  }
  else Bcontent.innerHTML = "";
});


function readSetB(){
  const type = methodB.value;

  if(type==="members"){
    const t = membersB.value.trim();
    const nums = t.match(/-?\d+/g);
    return nums ? {type:"finite", members:[...new Set(nums.map(Number))]} : {type:"empty"};
  }

  if(type==="symbol"){
    const t = symbolB.value;
    const nums = t.match(/-?\d+/g);

    if(nums) return {type:"finite", members:[...new Set(nums.map(Number))]};
    return {type:"symbolic", raw:t};
  }

  if(type==="known"){
    return {type:"symbolic", symbol:knownB.value};
  }

  return {type:"empty"};
}


// ======================= Ø¹Ù…Ù„ÛŒØ§Øª =======================
function union(A,B){ return [...new Set([...A,...B])].sort((a,b)=>a-b); }
function intersection(A,B){ return A.filter(x=>B.includes(x)).sort((a,b)=>a-b); }
function difference(A,B){ return A.filter(x=>!B.includes(x)).sort((a,b)=>a-b); }
function subset(A,B){ return A.every(x=>B.includes(x)); }

const resultBox = document.getElementById("resultBox");

document.getElementById("btnCompute").onclick = () => {
  const op = operation.value;
  if(!op){ resultBox.innerText = "ÛŒÚ© Ø¹Ù…Ù„ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯."; return; }

  const B = readSetB();
  resultBox.innerHTML = "";

  // Ø¹Ù…Ù„ÛŒØ§Øª Ø±ÙˆÛŒ Ù…ØªÙ†Ø§Ù‡ÛŒâ€ŒÙ‡Ø§
  if(setA.type==="finite" && B.type==="finite"){
    const Avals = setA.members;
    const Bvals = B.members;

    let C=null;

    if(op==="union") C = union(Avals,Bvals);
    if(op==="intersection") C = intersection(Avals,Bvals);
    if(op==="difference") C = difference(Avals,Bvals);
    if(op==="subset"){
      resultBox.innerHTML = subset(Avals,Bvals) ? "Ø¨Ù„Ù‡ØŒ Ø²ÛŒØ±Ù…Ø¬Ù…ÙˆØ¹Ù‡ Ø§Ø³Øª." : "Ø®ÛŒØ±ØŒ Ø²ÛŒØ±Ù…Ø¬Ù…ÙˆØ¹Ù‡ Ù†ÛŒØ³Øª.";
      return;
    }

    resultBox.innerHTML = `{ ${C.join(", ")} }`;
    return;
  }

  // Ø­Ø§Ù„Øª Ù†Ù…Ø§Ø¯ÛŒ
  resultBox.innerHTML =
    "Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† Ù†ÙˆØ¹ Ù…Ø¬Ù…ÙˆØ¹Ù‡â€ŒÙ‡Ø§ Ù†ØªÛŒØ¬Ù‡ Ø¨Ù‡â€ŒØµÙˆØ±Øª Ù†Ù…Ø§Ø¯ÛŒ ØªÙˆØ¶ÛŒØ­ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯ Ùˆ Ù‚Ø§Ø¨Ù„ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø¯Ù‚ÛŒÙ‚ Ù†ÛŒØ³Øª (Ù†Ø§Ù…ØªÙ†Ø§Ù‡ÛŒ).";
};


// ======================= Ø°Ø®ÛŒØ±Ù‡ Ù†ØªÛŒØ¬Ù‡ =======================
document.getElementById("btnSave").onclick = () => {
  const text = resultBox.innerText || "Ø¨Ø¯ÙˆÙ† Ù†ØªÛŒØ¬Ù‡";
  const arr = JSON.parse(localStorage.getItem("ops_history") || "[]");

  arr.unshift({
    time: new Date().toLocaleString("fa-IR"),
    result: text
  });

  localStorage.setItem("ops_history", JSON.stringify(arr.slice(0,20)));
  loadHistory();
  alert("Ù†ØªÛŒØ¬Ù‡ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯.");
};


// ======================= Ù†Ù…Ø§ÛŒØ´ ØªØ§Ø±ÛŒØ®Ú†Ù‡ =======================
function loadHistory(){
  const arr = JSON.parse(localStorage.getItem("ops_history") || "[]");
  if(arr.length===0){
    history.innerHTML = "<div style='color:#888'>Ù‡ÛŒÚ† Ù†ØªÛŒØ¬Ù‡â€ŒØ§ÛŒ Ø°Ø®ÛŒØ±Ù‡ Ù†Ø´Ø¯Ù‡.</div>";
    return;
  }

  history.innerHTML = arr.map(h =>
    `<div style="padding:8px; border-radius:8px; background:#fff; margin-bottom:8px; border:1px solid #eee;">
      <div style="font-size:12px;color:#666">${h.time}</div>
      <pre>${h.result}</pre>
     </div>`
  ).join("");
}
loadHistory();


// ======================= Ø§Ù†ÛŒÙ…ÛŒØ´Ù† Ù†ÙˆØ§Ø± Ø¹Ù…Ù„ÛŒØ§Øª =======================
const ops = document.querySelectorAll(".op");
let idx = 0;

setInterval(()=>{
  ops.forEach(o=>o.classList.remove("active"));
  ops[idx].classList.add("active");
  idx = (idx+1) % ops.length;
}, 900);

</script>

</body>
</html>
